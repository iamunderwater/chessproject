<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Game</title>

<style>
  :root{
    --bg: #0d0d0d;
    --panel: #111;
    --accent: #00ffff70;
    --whiteSquare: #f0d9b5;
    --darkSquare: #b58863;
  }

  body {
    background: var(--bg);
    color: #fff;
    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    min-height: 100vh;
    margin: 0;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 18px;
  }

  /* Page container */
  .container {
    width: 100%;
    max-width: 1200px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap: 24px;
  }

  /* Game area: timers + board */
  .game-area {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    width: 100%;
  }

  /* Timer column */
  .timer-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    min-width: 120px;
  }

  .timer-box {
    background: var(--panel);
    padding: 14px 18px;
    border-radius: 10px;
    box-shadow: 0 0 14px rgba(0,0,0,0.6);
    text-align: center;
    font-weight: 700;
    font-size: clamp(18px, 2.6vw, 28px);
    width: 110px;
    user-select: none;
  }

  .timer-label {
    display:block;
    font-size: 12px;
    font-weight:600;
    opacity:0.7;
    margin-bottom:6px;
  }

  /* Board container to constrain size */
  .board-wrap {
    display:flex;
    align-items:center;
    justify-content:center;
    width: min(68vw, 68vh, 720px);
  }

  /* Responsive Chessboard */
  .chessboard {
    width: 100%;
    height: 100%;
    aspect-ratio: 1 / 1;
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(8, 1fr);
    box-shadow: 0 0 20px #222;
    border-radius: 6px;
    transition: transform .25s ease;
    overflow: hidden;
  }

  .square {
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
  }

  .light { background: var(--whiteSquare); }
  .dark  { background: var(--darkSquare); }

  .piece-img {
    width: 80%;
    height: 80%;
    user-select:none;
    pointer-events:none;
  }

  .flipped { transform: rotate(180deg); }
  .flipped .square { transform: rotate(180deg); }

  /* Selected piece outline */
  .piece.selected {
    outline: 3px solid rgba(0,200,255,0.9);
    outline-offset: 4px;
    border-radius: 6px;
  }

  /* Highlights */
  .square.dot::after {
    content:"";
    width:18%;
    height:18%;
    background: rgba(0,0,0,0.25);
    border-radius:50%;
    position:absolute;
  }
  .square.capture::after {
    content:"";
    width:36%;
    height:36%;
    border:4px solid rgba(255,0,0,0.65);
    border-radius:50%;
    position:absolute;
  }

  /* Popup */
  #popup {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 40;
  }
  #popup.show { display:flex; }
  #popup-content {
    background:#222;
    padding:28px 36px;
    border-radius:12px;
    text-align:center;
  }
  #play-again {
    padding:8px 16px;
    border-radius:8px;
    background:#0b7;
    color:#041;
    border:none;
    font-weight:700;
    cursor:pointer;
  }

  /* Small screens: stack timers above/below board */
  @media (max-width: 880px) {
    .game-area {
      flex-direction: column;
      gap: 12px;
    }
    .timer-col {
      flex-direction: row;
      gap: 12px;
      min-width: auto;
    }
    .timer-box { width: auto; padding: 10px 14px; font-size: clamp(14px, 5.5vw, 20px); }
    .container { padding: 12px; }
    .board-wrap { width: min(92vw, 92vh); }
  }

  /* Very narrow phones: slightly smaller timers */
  @media (max-width: 420px) {
    .timer-box { font-size: 16px; padding: 8px 12px; }
    .timer-label { font-size: 11px; }
  }
</style>
</head>

<body>
  <div class="container">
    <div class="game-area">
      <!-- Left timer column (opponent) -->
      <div class="timer-col" style="align-items:center;">
        <div class="timer-box" id="left-timer">
          <span class="timer-label" id="left-label">Opponent</span>
          <span id="left-time">05:00</span>
        </div>
      </div>

      <!-- Board -->
      <div class="board-wrap">
        <div class="chessboard"></div>
      </div>

      <!-- Right timer column (you) -->
      <div class="timer-col" style="align-items:center;">
        <div class="timer-box" id="right-timer">
          <span class="timer-label" id="right-label">You</span>
          <span id="right-time">05:00</span>
        </div>
      </div>
    </div>
  </div>

  <div id="popup">
    <div id="popup-content">
      <span id="popup-text"></span><br><br>
      <button id="play-again">Play Again üîÅ</button>
    </div>
  </div>

<script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script>
  const ROOM_ID = "<%= roomId %>";
</script>
<script src="/js/chessgame.js"></script>
</body>
</html>