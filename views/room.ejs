<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess Game</title>

<style>
  :root{
    --bg: #0d0d0d;
    --panel: #111;
    --whiteSquare: #f0d9b5;
    --darkSquare: #b58863;
  }

  body {
    background: var(--bg);
    color: #fff;
    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    min-height: 100vh;
    margin: 0;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 18px;
  }

  /* Layout container */
  .container {
    width: 100%;
    max-width: 1300px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .game-area {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    width: 100%;
  }

  /* Timers */
  .timer-col {
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    min-width:120px;
  }

  .timer-box {
    background: var(--panel);
    padding: 14px 18px;
    border-radius: 10px;
    box-shadow: 0 0 14px rgba(0,0,0,0.6);
    text-align: center;
    font-weight: 700;
    font-size: clamp(16px, 2.5vw, 28px);
    width:120px;
  }

  .timer-label {
    font-size: 12px;
    opacity: 0.8;
  }

  /* Board container */
  .board-wrap {
    width: min(70vw, 70vh, 740px);
    display:flex;
    align-items:center;
    justify-content:center;
  }

  /* Chessboard */
  .chessboard {
    width: 100%;
    aspect-ratio: 1/1;
    display: grid;
    grid-template-columns: repeat(8,1fr);
    grid-template-rows: repeat(8,1fr);
    border-radius: 6px;
    overflow:hidden;
    box-shadow:0 0 20px #222;
  }

  .square {
    display:flex;
    justify-content:center;
    align-items:center;
    position:relative;
  }

  .light { background: var(--whiteSquare); }
  .dark { background: var(--darkSquare); }

  /* PROPER piece centering */
  .piece {
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .piece-img {
    width:90%;
    height:auto;
    object-fit:contain;
    pointer-events:none;
    user-select:none;
  }

  /* Highlights */
  .piece.selected {
    outline: 3px solid rgba(0,200,255,0.9);
    outline-offset: 4px;
  }
  .square.dot::after {
    content:"";
    width:18%;
    height:18%;
    background:rgba(0,0,0,0.25);
    border-radius:50%;
    position:absolute;
  }
  .square.capture::after {
    content:"";
    width:36%;
    height:36%;
    border:4px solid rgba(255,0,0,0.6);
    border-radius:50%;
    position:absolute;
  }

  /* Popup */
  #popup {
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,0.75);
    z-index:50;
  }
  #popup.show { display:flex; }

  #popup-content {
    background:#222;
    padding:30px 40px;
    border-radius:12px;
    text-align:center;
  }

  #play-again {
    background:#0b7;
    border:none;
    color:#041;
    padding:10px 18px;
    border-radius:10px;
    font-weight:bold;
    cursor:pointer;
  }

  /* Mobile responsive */
  @media (max-width: 880px) {
    .game-area {
      flex-direction: column;
      gap: 16px;
    }
    .timer-col {
      flex-direction:row;
      gap:16px;
      min-width:unset;
    }
  }
</style>
</head>

<body>
  <div class="container">
    <div class="game-area">

      <!-- Left (opponent) -->
      <div class="timer-col">
        <div class="timer-box">
          <div class="timer-label" id="left-label">Opponent</div>
          <div id="left-time">05:00</div>
        </div>
      </div>

      <!-- Board -->
      <div class="board-wrap">
        <div class="chessboard"></div>
      </div>

      <!-- Right (you) -->
      <div class="timer-col">
        <div class="timer-box">
          <div class="timer-label" id="right-label">You</div>
          <div id="right-time">05:00</div>
        </div>
      </div>

    </div>
  </div>

  <!-- Popup -->
  <div id="popup">
    <div id="popup-content">
      <span id="popup-text"></span><br><br>
      <button id="play-again">Play Again üîÅ</button>
    </div>
  </div>

<script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script>
  const ROOM_ID = "<%= roomId %>";
</script>
<script src="/js/chessgame.js"></script>
</body>